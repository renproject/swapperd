---
title: Swapperd

language_tabs:
  - shell

toc_footers:
  - <a href='https://github.com/republicprotocol/swapperd'>Checkout our GitHub</a>
  - <a href='https://republicprotocol.com'>Support by Republic Protocol</a>

search: true
---

# Introduction

Welcome to Swapperd! You can use Swapperd execute cross-chain atomic swaps between Bitcoin, Ethereum, and ERC20 tokens.

# Installation

> Swapperd currently supports macOS, and Ubuntu. Run the following command in a terminal:

```shell
curl https://releases.republicprotocol.com/swapperd/install.sh -sSf | sh
```

Swapperd installs itself as a system service. In the event of an unexpected shutdown, Swapperd will automatically restart and resume all pending atomic swaps.

During installing, you will need to choose a `username` and `password`. These will be required when interacting with the authenticated HTTP endpoints exposed by Swapperd.

A `mneumonic` will be generated and printed to the terminal. Swapperd uses this `mneumonic`, with your `username` and `password`, to generate its Bitcoin and Ethereum private keys on-demand.

<aside class="success">
Swapperd nevers stores private keys to persistent storage. The `password` will be temporarily stored to persistent storage until the associated atomic swap has completed.
</aside>

<aside class="notice">
Backup the `username`, `paassowrd`, and `mnuemonic` generated during installation. Forgetting these could result in the loss of funds!
</aside>

# Authentication

> An example using HTTP Authentication:

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:7777/balances
```

Swapperd protects itself using HTTP Basic Authentication. Swapperd protects all HTTP endpoints that require a Bitcoin or Ethereum private key.

<aside class="success">
Use the <code>username</code> and <code>password</code> that you entered during installation.
</aside>

# Swaps

Executing an atomic swap requires two parties to participate an interactive swapping process. This interactive swapping process will either result in both parties exchanging their tokens, or both parties keeping their tokens.

Before beginning an atomic swap, it is assumed that the two parties:

1. Agree that one party will begin the atomic swap.  
2. Exchange their Swapperd addresses for the relevant tokens.

Before responding to an atomic swap, it is assumed that the two parties:

1. Exchange the `timeLock` and `secretHash` generated by the party that begins the atomic swap.

**This agreement and exchange must happen at the application level.**

All other interactions are handled by Swapperd. Swapperd is built to be fault-tolerant and in the event of unexpected shutdown, or unexpected errors, it will resume and retry actions as needed. All actions are idempotent and cannot result in an accidental double execution.

<aside class="notice">
Swapperd cannot execute the interactive swapping process when the host machine is shutdown, or offline. Keeping the host machine shutdown, or offline, for more than 24 hours could result in the loss of funds!
</aside>

## Beginning an atomic swap

> Beginning an atomic swap by initating first:

```shell
curl -i      \
     -X POST \
     -d '{ "sendToken": "BTC",                                          
           "receiveToken": "WBTC",                                      
           "sendAmount": "100000000",                                   
           "receiveAmount": "100000000",                                
           "sendTo": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",              
           "receiveFrom": "0x5E6B16d705D81ec0822e6926E7841267Fa490b3E", 
           "shouldInitiateFirst": true }' \
     http://username:password@localhost:7777/swaps
```

> The response body is structured like this:

```json
{
  "id": "U1nWa7ggpDEFSh3ChZMxni6YZwy6SbcYpAy/Wc7CRRQ=",
  "sendToken": "BTC",
  "receiveToken": "WBTC",
  "sendAmount": "100000000",
  "receiveAmount": "100000000",
  "sendTo": "mzcJVzZgVcgmErPp2bu4DzXcdHpHA7wy1b",
  "receiveFrom": "0x43256f96601178Fd8594E02eed2e0d41f68DBb27",
  "timeLock": 1639947328,
  "secretHash": "4HOqdX0HpFtRz9bmPrYC2IYtAIOgsxCiN8L9+mp00zY=",
  "shouldInitiateFirst": true
}
```

The beginning party sends a HTTP request to his Swapperd using the agreed addresses.

Swapperd will validate the request and generate a `timeLock` and `secretHash` that must be sent to the other party. **This exchange must happen at the application level.**

### HTTP Request

`POST http://localhost:7777/swaps`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

## Responding to an atomic swap

> Respond to an atomic swap by initating second:

```shell
curl -i      \
     -X POST \
     -d '{ "sendToken": "WBTC",
           "receiveToken": "BTC",
           "sendAmount": "100000000",
           "receiveAmount": "100000000",
           "sendTo": "0x5E6B16d705D81ec0822e6926E7841267Fa490b3E",
           "receiveFrom": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",
           "timeLock": 1639947328,
           "secretHash": "4HOqdX0HpFtRz9bmPrYC2IYtAIOgsxCiN8L9+mp00zY=",
           "shouldInitiateFirst": false }' \
     http://username:password@localhost:7777/swaps
```

> The response body is structured like this:

```json
{
  "id": "S1Jn5MTLBqD8M2lm6vYjt1n2qy7XlW7sjHyIY3eInNA=",
  "sendToken": "WBTC",
  "receiveToken": "BTC",
  "sendAmount": "100000000",
  "receiveAmount": "100000000",
  "sendTo": "0x5E6B16d705D81ec0822e6926E7841267Fa490b3E",
  "receiveFrom": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",
  "timeLock": 1639947328,
  "secretHash": "4HOqdX0HpFtRz9bmPrYC2IYtAIOgsxCiN8L9+mp00zY=",
  "shouldInitiateFirst": false
}
```

After receiving the `timeLock` and `secretHash`, the responding party sends a HTTP request to his Swapperd using these values and the agreed addresses.

### HTTP Request

`POST http://localhost:7777/swaps`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

## Get pending atomic swaps

```shell
curl -i     \
     -X GET \
     http://localhost:7777/swaps
```

> The response body is structured like this:

```json
{
  "swaps": [
    {
      "id": "S1Jn5MTLBqD8M2lm6vYjt1n2qy7XlW7sjHyIY3eInNA=",
      "status": 1
    }
  ]
}
```

### HTTP Request

`GET http://localhost:7777/swaps`

<aside class="notice">
This is not a protected HTTP endpoint.
</aside>

# Balances

## Get balances

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:7777/balances
```

> The response body is structured like this:

```json
{
  "balances": [
    {
      "token": "BTC",
      "address": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",
      "amount": "13565"
    },
    {
      "token": "ETH",
      "address": "0x5E6B16d705D81ec0822e6926E7841267Fa490b3E",
      "amount": "990038930600000000"
    },
    {
      "token": "WBTC",
      "address": "0x5E6B16d705D81ec0822e6926E7841267Fa490b3E",
      "amount": "999846435"
    }
  ]
}
```

### HTTP Request

`GET http://localhost:7777/balances`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

# Withdrawals

## Withdrawing funds

```shell
curl -i      \
     -X POST \
     -d '{ "to": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",
           "token": "BTC",
           "amount": "100000000" }' \
     http://username:password@localhost:7777/withdrawals
```

> The response body is structured like this:

```json
{}
```

### HTTP Request

`POST http://localhost:7777/withdrawals`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

# Whoami

## Getting information about Swapperd

```shell
curl -i     \
     -X GET \
     http://localhost:7777/whoami
```

> The response body is structured like this:

```json
{
  "version": "0.1.0",
  "supportedTokens": [
    {
      "name": "BTC",
      "blockchain": "bitcoin"
    },
    {
      "name": "ETH",
      "blockchain": "ethereum"
    },
    {
      "name": "WBTC",
      "blockchain": "ethereum"
    }
  ]
}
```

### HTTP Request

`GET http://localhost:7777/whoami`

<aside class="notice">
This is not a protected HTTP endpoint.
</aside>

# Errors

Swapperd uses the following error codes:

Error Code | Meaning
---------- | -------
400 | Bad Request -- The request is invalid.
401 | Unauthorized -- The username or password is invalid.
404 | Not Found -- The HTTP endpoint or method is invalid.
500 | Internal Server Error -- Swapperd has encountered an unexpected error. Please submit a bug report!
